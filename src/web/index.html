<!doctype html>
<html lang="zh-TW">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta
      http-equiv="Content-Security-Policy"
      content="default-src 'self'; script-src 'self' 'unsafe-inline' https://cdn.jsdelivr.net; style-src 'self' 'unsafe-inline' https://fonts.googleapis.com; font-src https://fonts.gstatic.com; img-src 'self' data:; connect-src 'self' https://cdn.jsdelivr.net;"
    />
    <title>AI BRAINSTORMING | æˆ°ç•¥å¤§è…¦æœƒè­°å®¤</title>
    <link
      rel="icon"
      href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>ğŸ§ </text></svg>"
    />
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
    <link
      href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700&family=Inter:wght@300;400;600&family=Noto+Sans+TC:wght@300;400;700&display=swap"
      rel="stylesheet"
    />
    <style>
      :root {
        --bg-color: #050505;
        --glass-bg: rgba(255, 255, 255, 0.05);
        --accent-color: #00f2ff;
        --accent-purple: #ff00ff;
        --text-main: #ffffff;
        --text-dim: #a0a0a0;
        --card-shadow: 0 8px 32px rgba(0, 0, 0, 0.8);
      }

      body {
        background-color: var(--bg-color);
        color: var(--text-main);
        font-family: 'Inter', 'Noto Sans TC', sans-serif;
        margin: 0;
        padding: 40px;
        display: flex;
        flex-direction: column;
        align-items: center;
      }

      .header {
        width: 100%;
        max-width: 1100px;
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 40px;
      }

      h1 {
        font-family: 'Orbitron', sans-serif;
        letter-spacing: 4px;
        color: var(--accent-color);
        margin: 0;
        text-shadow: 0 0 20px rgba(0, 242, 255, 0.4);
      }

      .guide-btn {
        background: transparent;
        border: 1px solid var(--accent-color);
        color: var(--accent-color);
        padding: 10px 20px;
        border-radius: 30px;
        cursor: pointer;
        font-size: 0.9rem;
        transition: all 0.3s;
        text-transform: uppercase;
        font-family: 'Orbitron', sans-serif;
      }

      .guide-btn:hover {
        background: var(--accent-color);
        color: black;
        box-shadow: 0 0 20px rgba(0, 242, 255, 0.4);
      }

      .trigger-btn {
        background: linear-gradient(135deg, var(--accent-color), var(--accent-purple));
        border: none;
        color: black;
        padding: 12px 25px;
        border-radius: 30px;
        cursor: pointer;
        font-size: 1rem;
        font-weight: bold;
        transition: all 0.3s;
        text-transform: uppercase;
        font-family: 'Orbitron', sans-serif;
        margin-left: 15px;
        box-shadow: 0 0 15px rgba(0, 242, 255, 0.3);
      }

      .trigger-btn:hover {
        transform: scale(1.05);
        box-shadow: 0 0 25px rgba(0, 242, 255, 0.6);
      }

      .trigger-btn:active {
        transform: scale(0.95);
      }

      .trigger-btn:disabled {
        background: #444;
        color: #888;
        cursor: not-allowed;
        transform: none;
        box-shadow: none;
      }

      .dashboard-container {
        width: 100%;
        max-width: 1100px;
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 25px;
      }

      .card {
        background: var(--glass-bg);
        backdrop-filter: blur(15px);
        border: 1px solid rgba(255, 255, 255, 0.1);
        border-radius: 20px;
        padding: 25px;
        box-shadow: var(--card-shadow);
      }

      .card-full {
        grid-column: span 2;
      }

      h2 {
        font-size: 1rem;
        color: var(--accent-color);
        margin-top: 0;
        margin-bottom: 20px;
        text-transform: uppercase;
        letter-spacing: 2px;
        border-left: 4px solid var(--accent-color);
        padding-left: 15px;
      }

      .experience-list {
        max-height: 350px;
        overflow-y: auto;
        list-style: none;
        padding: 0;
      }

      .experience-item {
        padding: 15px;
        border-bottom: 1px solid rgba(255, 255, 255, 0.05);
        transition: background 0.2s;
      }

      .experience-item:hover {
        background: rgba(255, 255, 255, 0.02);
      }

      .badge {
        background: var(--accent-color);
        color: black;
        padding: 2px 8px;
        border-radius: 4px;
        font-weight: bold;
        margin-right: 10px;
        font-size: 0.7rem;
        display: inline-block;
      }

      .lesson {
        display: block;
        color: var(--text-dim);
        margin-top: 8px;
        font-size: 0.85rem;
        border-top: 1px solid rgba(255, 255, 255, 0.05);
        padding-top: 8px;
        white-space: pre-line;
        line-height: 1.6;
      }

      .thinking-spinner {
        width: 20px;
        height: 20px;
        border: 2px solid rgba(111, 66, 193, 0.2);
        border-top: 2px solid var(--accent-purple);
        border-radius: 50%;
        animation: spin 1s linear infinite;
      }

      @keyframes spin {
        0% {
          transform: rotate(0deg);
        }
        100% {
          transform: rotate(360deg);
        }
      }

      /* å½ˆçª— */
      .modal {
        display: none;
        position: fixed;
        z-index: 1000;
        left: 0;
        top: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(0, 0, 0, 0.9);
        overflow-y: auto;
      }

      .modal-content {
        background: #0f0f0f;
        margin: 5% auto;
        padding: 40px;
        border: 1px solid var(--accent-color);
        width: 80%;
        max-width: 800px;
        border-radius: 20px;
        box-shadow: 0 0 50px rgba(0, 242, 255, 0.2);
      }

      .close {
        color: var(--text-dim);
        float: right;
        font-size: 28px;
        font-weight: bold;
        cursor: pointer;
      }

      .close:hover {
        color: white;
      }

      .guide-body {
        line-height: 1.8;
        color: #ccc;
      }
      .guide-body h2 {
        color: var(--accent-color);
        font-size: 1.3rem;
        margin-top: 30px;
        border: none;
        padding: 0;
      }

      ::-webkit-scrollbar {
        width: 6px;
      }
      ::-webkit-scrollbar-thumb {
        background: rgba(255, 255, 255, 0.1);
        border-radius: 10px;
      }
    </style>
  </head>
  <body>
    <div class="header">
      <h1>
        AI BRAINSTORMING <span style="font-weight: 300; opacity: 0.6">WAR ROOM</span>
        <span
          id="currentSessionTopic"
          style="font-size: 1rem; color: var(--accent-color); margin-left: 20px"
          >[ç­‰å¾…è­°é¡Œ...]</span
        >
      </h1>
      <div>
        <button class="guide-btn" onclick="openGuide()">å¹³å°èªªæ˜ [HELP]</button>
        <button id="startSessionBtn" class="trigger-btn" onclick="startBrainstorm()">
          é–‹å•Ÿè…¦åŠ›æ¿€ç›ª [GO]
        </button>
        <button
          onclick="location.reload()"
          style="
            background: none;
            border: 1px solid #444;
            color: #666;
            padding: 5px 10px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 0.7rem;
            margin-left: 10px;
          "
        >
          å¼·åˆ·æ–° [RESET UI]
        </button>
      </div>
    </div>

    <div class="dashboard-container">
      <!-- ç³»çµ±æŒ‡æ®ä¸­å¿ƒ (System Command Center) -->
      <div
        class="card card-full"
        style="border: 1px solid var(--accent-color); background: rgba(0, 242, 255, 0.02)"
      >
        <h2 style="color: var(--accent-color)">ç³»çµ±æŒ‡æ®ä¸­å¿ƒ (System Command Center)</h2>
        <div style="display: flex; gap: 20px">
          <div style="flex: 1">
            <label
              style="display: block; font-size: 0.75rem; color: var(--text-dim); margin-bottom: 8px"
              >åˆ‡æ›æœƒè­°ä¸»é¡Œ (Switch Theme)</label
            >
            <select
              id="assetSwitcher"
              onchange="switchAsset(this.value)"
              style="
                width: 100%;
                background: #111;
                border: 1px solid #333;
                color: white;
                padding: 10px;
                border-radius: 5px;
                cursor: pointer;
              "
            >
              <option value="default">é è¨­ä¸»é¡Œ</option>
            </select>
          </div>
        </div>
      </div>

      <!-- ä¸»ç†äººæ§åˆ¶å° (Master Console) -->
      <div
        class="card card-full"
        style="border: 1px solid var(--accent-color); background: rgba(0, 242, 255, 0.02)"
      >
        <div
          style="
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
          "
        >
          <h2 style="color: var(--accent-color); margin: 0">ä¸»ç†äººæ§åˆ¶å° (Master Console)</h2>
          <select
            id="scenarioSelector"
            onchange="loadScenario()"
            style="
              background: #000;
              color: var(--accent-purple);
              border: 1px solid var(--accent-purple);
              padding: 5px 10px;
              border-radius: 5px;
              cursor: pointer;
              font-size: 0.9rem;
            "
          >
            <option value="">ğŸ“‚ è¼‰å…¥æˆ°ç•¥åŠ‡æœ¬ (Load Playbook)...</option>
            <optgroup label="ğŸ’¼ å•†æ¥­èˆ‡è·å ´ (Business & Career)">
              <option value="crisis">ğŸ”¥ ã€å±æ©Ÿå…¬é—œã€‘å“ç‰Œè²è­½ä¿®å¾©</option>
              <option value="launch">ğŸš€ ã€ç”¢å“ç™¼å¸ƒã€‘AI æ–°ç”¢å“ä¸Šå¸‚</option>
              <option value="reform">âš”ï¸ ã€çµ„ç¹”è®Šé©ã€‘ä¼æ¥­è½‰å‹èˆ‡è£å“¡</option>
              <option value="blue_ocean">ğŸŒŠ ã€è—æµ·ç­–ç•¥ã€‘å°‹æ‰¾æœªé–‹ç™¼å¸‚å ´</option>
              <option value="manage">ğŸ¤ ã€åœ˜éšŠç®¡ç†ã€‘è¡çªèª¿è§£èˆ‡æ¿€å‹µ</option>
              <option value="career">ğŸ“ ã€è·æ¶¯ç™¼å±•ã€‘ä¸­å¹´è½‰è·èˆ‡å‡é·</option>
              <option value="negotiate">ğŸ™ï¸ ã€æºé€šè«‡åˆ¤ã€‘é«˜é¢¨éšªå•†å‹™è«‡åˆ¤</option>
            </optgroup>
            <optgroup label="ğŸŒ± ç”Ÿæ´»èˆ‡æˆé•· (Life & Self-Growth)">
              <option value="learning">ğŸ§  ã€å­¸ç¿’æˆé•·ã€‘è·¨é ˜åŸŸæŠ€èƒ½é€Ÿæˆ</option>
              <option value="finance">ğŸ’° ã€è²¡å‹™è‡ªç”±ã€‘é€€ä¼‘è³‡ç”¢é…ç½®</option>
              <option value="health">ğŸ’ª ã€å¥åº·ç”Ÿæ´»ã€‘æ¸›é‡èˆ‡é«”èƒ½å„ªåŒ–</option>
              <option value="travel">âœˆï¸ ã€å®¶åº­æ—…éŠã€‘è¤‡é›œè¡Œç¨‹è¦åŠƒ</option>
            </optgroup>
          </select>
        </div>

        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px">
          <div>
            <label
              style="display: block; font-size: 0.75rem; color: var(--text-dim); margin-bottom: 8px"
              >é‡å°è­°é¡Œç›®æ¨™ (Session Goal / Directive)</label
            >
            <input
              type="text"
              id="sessionTopic"
              placeholder="è­°é¡Œä¸»é¡Œï¼Œä¾‹å¦‚: å“ç‰Œè½‰å‹ç­–ç•¥"
              style="
                width: 100%;
                background: #000;
                border: 1px solid var(--accent-color);
                color: white;
                padding: 12px;
                border-radius: 5px;
                font-size: 1rem;
                margin-bottom: 10px;
              "
            />
            <textarea
              id="sessionContext"
              placeholder="è¨è«–ç›®æ¨™æˆ–è£œå……èƒŒæ™¯... (æœƒè­°ä¸­å¯éš¨æ™‚ä¿®æ”¹ä¸¦æŒ‰æ›´æ–°)"
              style="
                width: 100%;
                height: 60px;
                background: #000;
                border: 1px solid #333;
                color: white;
                padding: 10px;
                border-radius: 5px;
                resize: none;
              "
            ></textarea>
          </div>
          <div style="display: flex; flex-direction: column; justify-content: flex-end; gap: 10px">
            <button
              id="updateGoalBtn"
              onclick="updateSessionGoal()"
              disabled
              style="
                background: rgba(255, 255, 255, 0.1);
                color: #888;
                border: 1px solid #444;
                padding: 10px;
                border-radius: 5px;
                cursor: pointer;
              "
            >
              éš¨æ™‚æ›´æ–°ç›®æ¨™ [UPDATE GOAL]
            </button>
            <div style="font-size: 0.75rem; color: #555">
              * æœƒè­°é€²è¡Œä¸­ä¿®æ”¹ä¸Šæ–¹æè¿°å¾ŒæŒ‰ [UPDATE] å¯å³æ™‚æ”¹è®Š AI è¨è«–æ–¹å‘
            </div>
          </div>
        </div>
      </div>

      <!-- åœ˜éšŠé…ç½®çª— (Team Roster) -->
      <div class="card card-full">
        <div
          style="
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
          "
        >
          <h2>AI æˆ°ç•¥åœ˜éšŠé…ç½® (Team Roster)</h2>
          <button
            onclick="addTeamMember()"
            style="
              background: var(--accent-purple);
              color: white;
              border: none;
              padding: 5px 15px;
              border-radius: 5px;
              cursor: pointer;
              font-size: 0.8rem;
            "
          >
            + æ–°å¢ AI æˆå“¡
          </button>
        </div>
        <div id="teamContainer" style="display: flex; flex-wrap: wrap; gap: 15px">
          <!-- Team cards injected here -->
        </div>
      </div>

      <!-- å³æ™‚å‹•æ…‹è¦–çª—å€ (Dynamic Live Windows) -->
      <div
        id="brainstormField"
        style="
          display: grid;
          grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
          gap: 20px;
          margin-bottom: 30px;
          grid-column: span 2;
        "
      >
        <!-- AI opinion boxes injected here -->
      </div>

      <!-- é¦–å¸­æˆ°ç•¥å®˜ç¸½çµ (Synthesis & Action Plan) -->
      <div
        id="summarySection"
        class="card card-full"
        style="
          display: none;
          border: 2px solid var(--accent-purple);
          background: rgba(111, 66, 193, 0.05);
        "
      >
        <div
          style="
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
          "
        >
          <h2 style="color: var(--accent-purple); margin: 0">
            ğŸ¯ é¦–å¸­æˆ°ç•¥å®˜ï¼šå…¨æ¡ˆæ•´åˆæ±ºè­° (Action Plan)
          </h2>
          <div id="summarySpinner" class="thinking-spinner"></div>
        </div>
        <div
          id="summaryBox"
          style="
            font-size: 1rem;
            line-height: 1.8;
            color: #eee;
            white-space: pre-wrap;
            padding: 20px;
            background: #000;
            border-radius: 10px;
            border: 1px solid #333;
          "
        >
          æ­£åœ¨ç­‰å¾…åœ˜éšŠåˆæ­¥è¨è«–...
        </div>
      </div>

      <!-- æœƒè­°ç´€éŒ„ (Session Logs) -->
      <div class="card card-full">
        <h2>æ­·å²æœƒè­°ç²¾è¯ (Past Session Insights)</h2>
        <ul id="experienceList" class="experience-list">
          <!-- Session results injected here -->
        </ul>
      </div>
    </div>

    <!-- æŒ‡å—å½ˆçª— (Help Modal) -->
    <div id="guideModal" class="modal">
      <div class="modal-content">
        <span class="close" onclick="closeGuide()">&times;</span>
        <div id="guideContent" class="guide-body">
          <h2>AI æˆ°ç•¥å¤§è…¦æœƒè­°å®¤ ä½¿ç”¨æŒ‡å—</h2>
          <p>
            æ­¡è¿ä¾†åˆ° AI é›†é«”æ±ºç­–å¹³å°ã€‚åœ¨é€™è£¡ï¼Œæ‚¨æ˜¯æœ€é«˜ä¸»ç†äººï¼ˆMasterï¼‰ï¼Œè² è²¬è¨­å®šè­°é¡Œä¸¦æŒ‡å°æ‚¨çš„ AI
            å°ˆå®¶åœ˜éšŠã€‚
          </p>
          <ul>
            <li><strong>å¤šè¼ªè¨è«–æ¨¡å¼</strong> - AI åœ˜éšŠæœƒæŒçºŒé€²è¡Œå¤šè¼ªè¾¯è«–èˆ‡å°è«‡ï¼Œç›´åˆ°é”æˆå…±è­˜ã€‚</li>
            <li><strong>æˆ°ç•¥åŠ‡æœ¬</strong> - ä½¿ç”¨ä¸‹æ‹‰é¸å–®è¼‰å…¥ç¶“å…¸å•†æ¥­å ´æ™¯ï¼Œå¿«é€Ÿå•Ÿå‹•é«˜å“è³ªè¨è«–ã€‚</li>
            <li>
              <strong>å‹•æ…‹æŒ‡ä»¤</strong> - æœƒè­°é€²è¡Œä¸­ï¼Œæ‚¨å¯ä»¥ä¿®æ”¹æè¿°ä¸¦é»æ“Š [UPDATE GOAL]ï¼ŒAI
              åœ˜éšŠæœƒç«‹åˆ»ä¾ç…§æ–°æ–¹å‘èª¿æ•´ã€‚
            </li>
            <li>
              <strong>å…±è­˜æª¢æ ¸</strong> - æ¯è¼ªçµæŸå¾Œæœƒæœ‰ä¸€å€‹è‡ªå‹•è£åˆ¤è©•ä¼°è¨è«–æ·±åº¦ï¼Œæ±ºå®šæ˜¯å¦çºŒé–‹ä¸‹è¼ªã€‚
            </li>
          </ul>
        </div>
      </div>
    </div>

    <script>
      let currentTeam = [
        {
          id: 'ai-mold',
          name: 'æ¨¡å…·å·¥ç¨‹éƒ¨ä¸»ç®¡',
          role: 'è² è²¬æ¨¡å…·è¨­è¨ˆå¯©æŸ¥ã€é–‹æ¨¡å¯è¡Œæ€§è©•ä¼°èˆ‡æŠ€è¡“å•é¡Œè§£æ±º',
          color: '#ff9900',
        },
        {
          id: 'ai-qa',
          name: 'å“ä¿éƒ¨ä¸»ç®¡',
          role: 'å°ˆæ³¨æ–¼é¢¨éšªç®¡æ§ã€å“è³ªæ¨™æº–ã€è‰¯ç‡æ§åˆ¶èˆ‡å®¢è¨´é é˜²',
          color: '#00f2ff',
        },
        {
          id: 'ai-sales',
          name: 'æ¥­å‹™éƒ¨ä¸»ç®¡',
          role: 'è² è²¬å®¢æˆ¶éœ€æ±‚é‡æ¸…ã€è¨‚å–®äº¤æœŸå”èª¿èˆ‡å¸‚å ´åé¥‹',
          color: '#00ff00',
        },
      ];
      let currentSessionId = null;

      const SCENARIOS = {
        crisis: {
          topic: 'æ‡‰å°é‡å¤§å“ç‰Œå…¬é—œå±æ©Ÿ',
          context:
            'èƒŒæ™¯ï¼šå…¬å¸æ ¸å¿ƒç”¢å“è¢«çˆ†å‡ºå­˜åœ¨å®‰å…¨éš±æ‚£ï¼Œç¤¾äº¤åª’é«”ä¸Šè² é¢è¼¿è«–æ­£åœ¨ç™¼é…µï¼Œè‚¡åƒ¹ä¸‹è·Œ 5%ã€‚\nç›®æ¨™ï¼šåˆ¶å®šç·Šæ€¥å…¬é—œå›æ‡‰ç­–ç•¥ï¼Œä¸¦åœ¨ 24 å°æ™‚å…§æ§åˆ¶æå®³ï¼Œæ¢å¾©å…¬çœ¾ä¿¡ä»»ã€‚',
        },
        launch: {
          topic: 'AI å‰µæ–°ç”¢å“ä¸Šå¸‚ç™¼å¸ƒç­–ç•¥',
          context:
            'èƒŒæ™¯ï¼šæˆ‘å€‘é–‹ç™¼äº†ä¸€æ¬¾é©å‘½æ€§çš„å€‹äºº AI åŠ©ç†ï¼Œæº–å‚™åœ¨ä¸‹å€‹æœˆ CES å¤§å±•ä¸Šç™¼å¸ƒã€‚\nç›®æ¨™ï¼šè¨­è¨ˆä¸€å¥—èƒ½å¼•çˆ†å¸‚å ´è©±é¡Œçš„è¡ŒéŠ·æ¼æ–—ï¼Œç›®æ¨™æ˜¯åœ¨ç™¼å¸ƒé¦–æ—¥ç²å¾— 10 è¬è¨»å†Šç”¨æˆ¶ã€‚',
        },
        reform: {
          topic: 'ä¼æ¥­çµ„ç¹”é‡çµ„èˆ‡è£å“¡è¨ˆç•«',
          context:
            'èƒŒæ™¯ï¼šç”±æ–¼å¸‚å ´ç’°å¢ƒæƒ¡åŒ–ï¼Œå…¬å¸ç‡Ÿæ”¶ä¸‹æ»‘ 20%ï¼Œå¿…é ˆå‰Šæ¸›æˆæœ¬ä¸¦ç²¾ç°¡çµ„ç¹”çµæ§‹ã€‚\nç›®æ¨™ï¼šå¦‚ä½•åœ¨è£å“¡ 15% çš„åŒæ™‚ï¼Œç¶­æŒæ ¸å¿ƒäººæ‰çš„å£«æ°£ï¼Œä¸¦å®Œæˆå‘ã€Œæ•æ·é–‹ç™¼ã€æ¨¡å¼çš„è½‰å‹ï¼Ÿ',
        },
        blue_ocean: {
          topic: 'å°‹æ‰¾å¾Œç–«æƒ…æ™‚ä»£çš„è—æµ·å¸‚å ´',
          context:
            'èƒŒæ™¯ï¼šå‚³çµ±æ—…éŠæ¥­å¾©ç”¦ç·©æ…¢ï¼Œä½†æ•¸ä½éŠç‰§æ°‘æ— (Digital Nomads) ç¾¤é«”æ­£åœ¨å¿«é€Ÿå¢é•·ã€‚\nç›®æ¨™ï¼šæ§‹æ€ä¸€å€‹é‡å°æ­¤æ–°èˆˆç¾¤é«”çš„æœå‹™ç”Ÿæ…‹ç³»ï¼Œé¿é–‹ç´…æµ·ç«¶çˆ­ã€‚',
        },
        career: {
          topic: 'ä¸­å¹´è·æ¶¯è½‰å‹èˆ‡å‡é·ç­–ç•¥',
          context:
            'èƒŒæ™¯ï¼š40 æ­²ä¸­éšä¸»ç®¡ï¼Œé¢è‡¨è¡Œæ¥­å¤©èŠ±æ¿èˆ‡å¹´è¼•ä¸–ä»£ç«¶çˆ­ï¼ŒçŒ¶è±«æ˜¯å¦è©²è·³æ§½è‡³æ–°èˆˆ AI ç”¢æ¥­ã€‚\nç›®æ¨™ï¼šåˆ†æè½‰è·é¢¨éšªèˆ‡æ©Ÿæœƒï¼Œä¸¦è¦åŠƒæœªä¾† 5 å¹´çš„è·æ¶¯è·¯å¾‘èˆ‡å€‹äººå“ç‰Œé‡å¡‘ã€‚',
        },
        manage: {
          topic: 'åœ˜éšŠä¸–ä»£è¡çªèª¿è§£èˆ‡æ¿€å‹µ',
          context:
            'èƒŒæ™¯ï¼šåœ˜éšŠä¸­è³‡æ·±å“¡å·¥ (Gen X) èˆ‡æ–°é€²å“¡å·¥ (Gen Z) å› å·¥ä½œåƒ¹å€¼è§€ä¸åŒç”¢ç”Ÿæ‘©æ“¦ï¼Œå°è‡´å°ˆæ¡ˆé€²åº¦è½å¾Œã€‚\nç›®æ¨™ï¼šåˆ¶å®šä¸€å¥—èƒ½èåˆä¸åŒä¸–ä»£å„ªå‹¢çš„ç®¡ç†æ©Ÿåˆ¶ï¼Œä¸¦è¨­è¨ˆèƒ½åŒæ™‚æ¿€å‹µé›™æ–¹çš„çé…¬åˆ¶åº¦ã€‚',
        },
        negotiate: {
          topic: 'é«˜é¢¨éšªå•†å‹™è«‡åˆ¤æ¨¡æ“¬',
          context:
            'èƒŒæ™¯ï¼šå³å°‡èˆ‡é—œéµä¾›æ‡‰å•†é€²è¡Œå¹´åº¦åˆç´„è«‡åˆ¤ï¼Œå°æ–¹æš—ç¤ºå°‡æ¼²åƒ¹ 15%ï¼Œä½†æˆ‘æ–¹é ç®—å·²å‡çµã€‚\nç›®æ¨™ï¼šæ²™ç›¤æ¨æ¼”è«‡åˆ¤ç­–ç•¥ï¼Œæ‰¾å‡ºé›™è´çš„ç±Œç¢¼äº¤æ›é»ï¼Œç¢ºä¿æˆæœ¬æ§åˆ¶åœ¨ 5% æ¼²å¹…å…§ã€‚',
        },
        learning: {
          topic: 'è·¨é ˜åŸŸæŠ€èƒ½ 30 å¤©é€Ÿæˆè¨ˆç•«',
          context:
            'èƒŒæ™¯ï¼šéæŠ€è¡“èƒŒæ™¯çš„è¡ŒéŠ·äººå“¡ï¼Œæ€¥éœ€å­¸æœƒä½¿ç”¨ Python é€²è¡Œæ•¸æ“šåˆ†æä»¥æå‡å·¥ä½œæ•ˆç‡ã€‚\nç›®æ¨™ï¼šé‡èº«æ‰“é€ ä¸€ä»½é«˜å¼·åº¦çš„ 30 å¤©å­¸ç¿’èª²è¡¨ï¼ŒåŒ…å«å­¸ç¿’è³‡æºã€å¯¦ä½œå°ˆæ¡ˆèˆ‡æª¢æ ¸é»ã€‚',
        },
        finance: {
          topic: 'é‚å‘è²¡å‹™è‡ªç”±çš„è³‡ç”¢é…ç½®',
          context:
            'èƒŒæ™¯ï¼šé›™è–ªå®¶åº­ï¼Œå¹´æ”¶å…¥ç©©å®šä½†æ”¯å‡ºé«˜ï¼Œå¸Œæœ›åœ¨ 15 å¹´å¾Œé”æˆ FIRE (è²¡å‹™ç¨ç«‹ï¼Œææ—©é€€ä¼‘)ã€‚\nç›®æ¨™ï¼šæª¢è¦–ç›®å‰è²¡å‹™æ¼æ´ï¼Œä¸¦å»ºè­°é©åˆç•¶å‰ç¶“æ¿Ÿå±€å‹¢çš„è³‡ç”¢é…ç½®çµ„åˆï¼ˆè‚¡å‚µæˆ¿å¹£ï¼‰ã€‚',
        },
        health: {
          topic: 'å¿™ç¢Œå°ˆæ¥­äººå£«çš„é«”èƒ½å„ªåŒ–',
          context:
            'èƒŒæ™¯ï¼šé«˜å£“å·¥ä½œè€…ï¼Œé•·æœŸä¹…åã€ç¡çœ ä¸è¶³ä¸”é«”è„‚éé«˜ï¼Œæ²’æ™‚é–“å»å¥èº«æˆ¿ã€‚\nç›®æ¨™ï¼šè¨­è¨ˆä¸€å¥—ã€Œæ¥µç°¡ã€ä½†é«˜æ•ˆçš„é£²é£Ÿèˆ‡å±…å®¶è¨“ç·´æ–¹æ¡ˆï¼Œç›®æ¨™æ˜¯ 3 å€‹æœˆå…§é«”è„‚é™ 5%ã€‚',
        },
        travel: {
          topic: 'ä¸‰ä»£åŒå ‚çš„å®Œç¾å®¶æ—æ—…éŠ',
          context:
            'èƒŒæ™¯ï¼šè¨ˆç•«å¸¶ 70 æ­²çˆ¶æ¯èˆ‡ 5 æ­²å°å­©å»æ—¥æœ¬æ—…éŠ 7 å¤©ï¼Œéœ€è€ƒé‡é«”åŠ›è½å·®èˆ‡é£²é£Ÿåå¥½ã€‚\nç›®æ¨™ï¼šè¦åŠƒä¸€ä»½è®“è€å°‘ç›¡æ­¡çš„è©³ç´°è¡Œç¨‹è¡¨ï¼ŒåŒ…å«äº¤é€šå‹•ç·šã€ä¼‘æ¯é»èˆ‡ç·Šæ€¥å‚™æ¡ˆã€‚',
        },
      };

      function loadScenario() {
        const key = document.getElementById('scenarioSelector').value;
        if (SCENARIOS[key]) {
          document.getElementById('sessionTopic').value = SCENARIOS[key].topic;
          document.getElementById('sessionContext').value = SCENARIOS[key].context;
        }
      }

      async function init() {
        renderTeam(); // ç«‹å³æ¸²æŸ“é è¨­è§’è‰²
        await loadTeam();
        await loadHistory();
      }

      async function loadTeam() {
        try {
          const res = await fetch('/api/team');
          currentTeam = await res.json();
          renderTeam();
        } catch (err) {
          console.error('Failed to load team', err);
        }
      }

      function renderTeam() {
        const container = document.getElementById('teamContainer');
        if (!container) return;
        container.innerHTML = '';
        currentTeam.forEach((m, index) => {
          const card = document.createElement('div');
          card.className = 'card';
          card.style.flex = '1 1 250px';
          card.style.margin = '0';
          card.style.borderLeft = `4px solid ${m.color}`;
          card.innerHTML = `
                    <div style="display: flex; justify-content: space-between;">
                        <strong style="color: ${m.color}">${m.name}</strong>
                        <button onclick="removeMember(${index})" style="background: none; border: none; color: #666; cursor: pointer;">&times;</button>
                    </div>
                    <div style="font-size: 0.75rem; color: #aaa; margin-top: 5px;">${m.role}</div>
                `;
          container.appendChild(card);
        });
      }

      async function addTeamMember() {
        const name = prompt('AI å°ˆå®¶å§“å:');
        const role = prompt('å°ˆå®¶è·è²¬/å°ˆæ¥­é ˜åŸŸ:');
        if (!name || !role) return;

        const colors = ['#ff00ff', '#00f2ff', '#00ff00', '#ffcc00', '#ff4444'];
        currentTeam.push({
          id: 'ai-' + Date.now(),
          name,
          role,
          color: colors[currentTeam.length % colors.length],
        });
        await saveTeam();
      }

      async function removeMember(index) {
        currentTeam.splice(index, 1);
        await saveTeam();
      }

      async function saveTeam() {
        await fetch('/api/team', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ members: currentTeam }),
        });
        renderTeam();
      }

      async function startBrainstorm() {
        const topic = document.getElementById('sessionTopic').value;
        const context = document.getElementById('sessionContext').value;
        if (!topic) return alert('è«‹å…ˆè¼¸å…¥è¨è«–è­°é¡Œ');

        currentSessionId = 'session-' + Date.now();
        const field = document.getElementById('brainstormField');
        field.innerHTML = '';
        document.getElementById('summarySection').style.display = 'block';
        document.getElementById('summaryBox').innerText = 'æˆ°ç•¥è¨ˆç•«å•Ÿå‹•ä¸­...';
        document.getElementById('summarySpinner').style.display = 'block';

        currentTeam.forEach((m) => {
          const box = document.createElement('div');
          box.id = `box-${m.id}`;
          box.className = 'card';
          box.style.border = `1px solid ${m.color}`;
          box.style.background = 'rgba(0,0,0,0.8)';
          box.style.display = 'flex';
          box.style.flexDirection = 'column';
          box.style.maxHeight = '400px';
          box.innerHTML = `
                    <div style="display: flex; justify-content: space-between; margin-bottom: 10px; border-bottom: 1px solid rgba(255,255,255,0.1); padding-bottom: 5px;">
                        <span class="badge" style="background: ${m.color}; color: #000;">${m.name}</span>
                        <div id="spinner-${m.id}" class="thinking-spinner" style="display:none;"></div>
                    </div>
                    <div id="history-${m.id}" style="font-size: 0.85rem; line-height: 1.6; color: #888; overflow-y: auto;">ç­‰å¾…åŠ å…¥å°è©±...</div>
                `;
          field.appendChild(box);
        });

        const btn = document.getElementById('startSessionBtn');
        const updateBtn = document.getElementById('updateGoalBtn');
        btn.disabled = true;
        btn.innerText = 'æœƒè­°å‹•æ…‹é€²è¡Œä¸­...';
        updateBtn.disabled = false;
        updateBtn.style.background = 'var(--accent-color)';
        updateBtn.style.color = 'black';

        const url = `/api/brainstorm-stream?topic=${encodeURIComponent(topic)}&context=${encodeURIComponent(context)}&sessionId=${currentSessionId}`;
        const eventSource = new EventSource(url);

        eventSource.onmessage = (event) => {
          const data = JSON.parse(event.data);
          if (data.type === 'ROUND_START') {
            // Pre-show spinners
            currentTeam.forEach(
              (m) => (document.getElementById(`spinner-${m.id}`).style.display = 'block'),
            );
          } else if (data.type === 'THOUGHT' && data.memberId) {
            const histDiv = document.getElementById(`history-${data.memberId}`);
            const spinner = document.getElementById(`spinner-${data.memberId}`);
            const msg = document.createElement('div');
            msg.innerHTML = `<span style="color:var(--text-dim); font-size:0.7rem;">[Round ${data.round || ''}]</span><br>${data.message}`;
            msg.style.marginBottom = '10px';
            msg.style.color = 'white';
            msg.style.borderBottom = '1px solid rgba(255,255,255,0.05)';
            msg.style.paddingBottom = '5px';
            histDiv.appendChild(msg);
            histDiv.scrollTop = histDiv.scrollHeight;
            if (spinner) spinner.style.display = 'none';
          } else if (data.type === 'CONSENSUS') {
            document.getElementById('summaryBox').innerText =
              'ã€å…±è­˜æª¢æ ¸ã€‘\n' + data.message + '\n\næ­£åœ¨ç”¢å‡ºå…¨æ¡ˆåŸ·è¡Œè¨ˆç•«...';
          } else if (data.type === 'SUMMARY') {
            document.getElementById('summaryBox').innerText = data.message;
            document.getElementById('summarySpinner').style.display = 'none';
          } else if (data.type === 'COMPLETE') {
            eventSource.close();
            btn.disabled = false;
            btn.innerText = 'é–‹å•Ÿæ–°è­°é¡Œè…¦æ¿€ [GO]';
            updateBtn.disabled = true;
            updateBtn.style.background = 'rgba(255,255,255,0.1)';
            updateBtn.style.color = '#888';
            loadHistory();
          } else if (data.type === 'ERROR') {
            eventSource.close();
            alert(data.message);
            btn.disabled = false;
          }
        };
      }

      async function updateSessionGoal() {
        const goal = document.getElementById('sessionContext').value;
        if (!currentSessionId) return;
        const res = await fetch('/api/brainstorm/goal', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ sessionId: currentSessionId, goal }),
        });
        const data = await res.json();
        if (data.success) {
          const updateBtn = document.getElementById('updateGoalBtn');
          const oldText = updateBtn.innerText;
          updateBtn.innerText = 'ç›®æ¨™å·²åŒæ­¥ï¼';
          setTimeout(() => (updateBtn.innerText = oldText), 2000);
        }
      }

      // Aliases and UI helpers
      function triggerTick() {
        startBrainstorm();
      }
      function switchAsset(val) {
        console.log('Switching:', val);
      }

      async function loadHistory() {
        try {
          const res = await fetch('/api/experience');
          const exps = await res.json();
          const list = document.getElementById('experienceList');
          if (!list) return;
          list.innerHTML = '';
          exps
            .reverse()
            .slice(0, 10)
            .forEach((e) => {
              const li = document.createElement('li');
              li.className = 'experience-item';
              li.innerHTML = `
                        <div style="display: flex; justify-content: space-between;">
                            <strong>${e.decision || 'BRAINSTORM'}</strong>
                            <span style="font-size: 0.7rem; color: #555;">${new Date(e.created_at).toLocaleString()}</span>
                        </div>
                        <div class="lesson" style="margin-top: 10px; white-space: pre-wrap;">${e.lesson}</div>
                    `;
              list.appendChild(li);
            });
        } catch (err) {}
      }

      function openGuide() {
        document.getElementById('guideModal').style.display = 'block';
      }
      function closeGuide() {
        document.getElementById('guideModal').style.display = 'none';
      }

      init();
    </script>
  </body>
</html>
